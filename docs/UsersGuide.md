# PickPoints 利用者の手引（2025年8月版）

## はじめに

**PickPoints（Pick Points and Routes）** は、PNG画像のハイキングマップから視覚的にポイントやルートを選択し、座標データをJSONファイルとして出力するWebアプリケーションです。この手引では、基本的な使い方から応用的な機能まで、ステップバイステップで説明します。

## 目次

1. [動作環境](#1-動作環境)
2. [基本的な使い方](#2-基本的な使い方)
3. [ポイント編集機能](#3-ポイント編集機能)
4. [ルート編集機能](#4-ルート編集機能)
5. [レイアウト切り替え](#5-レイアウト切り替え)
6. [データの出力と読み込み](#6-データの出力と読み込み)
7. [トラブルシューティング](#7-トラブルシューティング)
8. [FAQ（よくある質問）](#8-faqよくある質問)

## 1. 動作環境

### 1.1 推奨環境
- **OS**: Windows 10/11, macOS 10.15+, Ubuntu 18.04+
- **ブラウザ**: Chrome 86+, Firefox 88+, Edge 90+, Safari 14+
- **画面解像度**: 1024×768以上
- **メモリ**: 4GB以上推奨

### 1.2 対応ファイル形式
- **入力画像**: PNG形式のみ
- **出力データ**: JSON形式
- **読み込みデータ**: JSON形式

## 2. 基本的な使い方

### 2.1 アプリケーションの起動
1. ブラウザでPickPointsのHTMLファイル（index.html）を開く
2. 「Pick Points and Routes」のタイトル画面が表示されます

### 2.2 PNG画像の読み込み
1. **「PNG画像を選択」ボタンをクリック**
2. PNG画像ファイルを選択
   - File System Access API対応ブラウザ（Chrome 86+, Edge 86+）では保存場所を記憶
   - その他のブラウザでは従来のファイル選択ダイアログを使用
3. 画像が地図表示エリアに読み込まれます
4. **「ポイントをクリア」「ポイントをJSON出力」ボタンが有効**になります

### 2.3 基本操作
- **ポイント配置**: 地図上をクリック
- **モード切り替え**: 画面右側の「ポイント編集」「ルート編集」で切り替え
- **レイアウト切り替え**: 画面右上の「サイドバー」「オーバーレイ」で切り替え

## 3. ポイント編集機能

### 3.1 ポイントの配置
1. **編集モード**で「ポイント編集」を選択（画像読み込み時は自動選択）
2. 地図上の任意の場所をクリック
3. **赤色のマーカー**が表示され、**ID入力ボックス**が自動で表示
4. ID入力ボックスに**自動フォーカス**が移ります

### 3.2 ポイントIDの入力
#### 3.2.1 推奨ID形式
- **「X-nn」形式**: 英大文字1桁 + ハイフン + 数字2桁
- **例**: A-01, B-15, C-99

#### 3.2.2 自動変換機能
- **全角→半角変換**: 全角英数字は自動で半角に変換
- **小文字→大文字変換**: 半角小文字は自動で大文字に変換
- **数字0埋め**: 1桁の数字は自動で0埋め（例: 1→01）
- **例**: 
  - 「ａ１」→「A-01」
  - 「b5」→「B-05」
  - 「Ｃ−２３」→「C-23」

#### 3.2.3 入力のルール
- **最大文字数**: 4文字まで
- **確定方法**: Enterキー または他の場所をクリック（blur）
- **削除条件**: ID入力を空白のままにすると、ポイントが自動削除されます

### 3.3 視覚的フィードバック
- **正しい形式**: 通常の白背景
- **不正な形式**: 薄いピンク色の背景で警告表示
- **ポイント数表示**: 画面右側に「ポイント数: X」としてリアルタイム表示

### 3.4 ポイントの管理
- **未入力ポイントの自動削除**: 新しいポイントを追加する際、直前の未入力ポイントは自動削除
- **全削除**: 「ポイントをクリア」ボタンで全ポイントを一括削除
- **入力ボックス配置**: 画面端を考慮した最適位置に自動配置

## 4. ルート編集機能

### 4.1 事前準備
**重要**: ルート編集を行う前に、必ず**ポイント編集モード**で開始ポイントと終了ポイントを事前に登録してください。

1. ポイント編集モードで開始地点をクリック → ID入力（例: A-01）
2. ポイント編集モードで終了地点をクリック → ID入力（例: B-05）

### 4.2 ルート編集の開始
1. **「ルート編集」モード**に切り替え
2. **開始ポイント**入力欄に事前登録したIDを入力（例: A-01）
3. **終了ポイント**入力欄に事前登録したIDを入力（例: B-05）
4. 入力と同時に該当ポイントが**青色**に変化します

### 4.3 中間点の配置
1. ルートの中間地点となる場所を地図上でクリック
2. **青色のマーカー**（小さいサイズ）が表示されます
3. ID入力は不要です
4. **中間点数**がリアルタイムで更新されます

### 4.4 ルート情報の管理
- **中間点数表示**: 「ルートの中間点数: X」として表示
- **全削除**: 「ルートをクリア」ボタンで中間点と開始/終了ポイント設定をクリア

## 5. レイアウト切り替え

### 5.1 サイドバーレイアウト（推奨）
- **構成**: 左側に地図、右側にコントロールパネル
- **適用場面**: デスクトップ環境での通常作業
- **特徴**: 安定したUI、操作しやすい

### 5.2 オーバーレイレイアウト
- **構成**: 全画面地図、右上にフローティングコントロールパネル
- **適用場面**: 大きな地図表示が必要な場合
- **特徴**: 最大限の地図表示エリア、半透明パネル

### 5.3 切り替え方法
画面右上の**レイアウト選択**で「サイドバー」または「オーバーレイ」を選択

## 6. データの出力と読み込み

### 6.1 ポイントデータの出力
1. ポイントを1個以上配置
2. **「ポイントをJSON出力」ボタン**をクリック
3. File System Access API対応ブラウザでは:
   - PNG画像と同じフォルダに保存ダイアログが開く
   - ファイル名: `{画像名}_points.json`
4. その他のブラウザでは従来のダウンロード方式

### 6.2 ルートデータの出力
1. 開始・終了ポイントを設定し、中間点を1個以上配置
2. **「ルートをJSON出力」ボタン**をクリック
3. 事前チェック:
   - 開始・終了ポイントがポイントとして登録されているかチェック
   - 設定不備があればエラーメッセージ表示
4. ファイル名: `{画像名}_route_{開始ポイント}-{終了ポイント}.json`

### 6.3 データの読み込み
#### 6.3.1 ポイントJSONの読み込み
1. **「ポイントのJSON読込」**でJSONファイルを選択
2. 前提条件: 画像が事前に読み込まれていること
3. 既存ポイントに加えて読み込まれます
4. マーカーの種類:
   - 通常ポイント: 赤色マーカー + ID入力ボックス
   - 読み込みマーカー: 小さい青色マーカー（編集不可）

#### 6.3.2 ルートJSONの読み込み
1. **「ルートのJSON読込」**でJSONファイルを選択
2. 前提条件: 画像が事前に読み込まれていること
3. 開始・終了ポイントIDが自動入力され、中間点が復元されます

## 7. トラブルシューティング

### 7.1 よくあるエラーと対処法

#### 画像が読み込まれない
- **確認事項**: PNG形式の画像であることを確認
- **対処法**: JPEGやGIFは非対応です。PNG形式に変換してください

#### ポイントが削除される
- **原因**: ID入力を空白のままにした
- **対処法**: 必ずIDを入力してからEnterキーを押すか他の場所をクリック

#### ルート出力でエラーが出る
- **確認事項**: 
  1. 開始・終了ポイントが事前にポイント編集モードで登録されているか
  2. 開始・終了ポイントIDが正しく入力されているか
  3. 中間点が1個以上配置されているか

#### File System Access APIが使えない
- **対象ブラウザ**: Chrome 86+, Edge 86+のみ対応
- **対処法**: 従来のダウンロード方式で自動的に保存されます

### 7.2 ブラウザ固有の問題

#### Safari使用時
- File System Access API非対応のため、従来のダウンロード方式になります
- ダウンロードフォルダに保存されます

#### Firefox使用時  
- File System Access API非対応のため、従来のダウンロード方式になります
- ダウンロード設定に従って保存されます

## 8. FAQ（よくある質問）

### Q1. IDはどのような形式で入力すればよいですか？
**A**: 推奨形式は「X-nn」（英大文字1桁-数字2桁）です。例: A-01, B-15。全角文字は自動で半角に変換され、1桁の数字は0埋めされます。

### Q2. 同じIDを複数のポイントに設定できますか？
**A**: 技術的には可能ですが、ルート編集時の混乱を避けるため、ユニークなIDの使用を推奨します。

### Q3. ポイントを後から移動することはできますか？
**A**: 現在のバージョンでは移動機能はありません。削除してから新しい位置に再配置してください。

### Q4. 大きなサイズのPNG画像でも使用できますか？
**A**: 使用可能ですが、非常に大きな画像（数十MB以上）はブラウザの動作が重くなる可能性があります。

### Q5. オフラインで使用できますか？
**A**: PickPointsはPWA対応していないため、オフライン使用はできません。インターネット接続が必要です。

### Q6. JSONデータの形式を教えてください。
**A**: ポイントデータには座標、ID、画像情報が含まれます。ルートデータには開始・終了ポイントID、中間点座標が含まれます。詳細は機能仕様書をご参照ください。

### Q7. スマートフォンやタブレットで使用できますか？  
**A**: レスポンシブデザインに対応していますが、デスクトップ環境での使用を推奨します。

### Q8. JSONファイルを他のアプリケーションで使用できますか？
**A**: はい。JSONは標準的なデータ形式なので、他のアプリケーションやプログラムで読み込み・加工が可能です。

---

## サポート情報

**アプリケーション名**: Pick Points and Routes  
**バージョン**: 2.0  
**作成日**: 2025年8月11日  
**技術サポート**: Claude Code  

この手引で解決しない問題がある場合は、機能仕様書もご参照ください。