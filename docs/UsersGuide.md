# PickPoints ユーザー手引

## 目次
1. [はじめに](#はじめに)
2. [アプリケーションの起動](#アプリケーションの起動)
3. [基本的な操作手順](#基本的な操作手順)
4. [ポイント編集モード](#ポイント編集モード)
5. [ルート編集モード](#ルート編集モード)
6. [レイアウトの切り替え](#レイアウトの切り替え)
7. [データの保存と読み込み](#データの保存と読み込み)
8. [よくある質問（FAQ）](#よくある質問faq)
9. [トラブルシューティング](#トラブルシューティング)

---

## はじめに

### PickPointsとは
PickPointsは、ハイキングマップなどのPNG画像からポイントを選択し、座標データをJSONファイルとして出力するWebアプリケーションです。

### 主な機能
- **ポイント編集**: 地図上の特定地点にポイントを配置し、IDを付与
- **ルート編集**: ルートの中間点（waypoint）を配置
- **データ出力**: ポイント・ルートデータをJSON形式で保存
- **データ読み込み**: 既存のJSONファイルからデータを復元

### 対応ファイル形式
- **入力**: PNG画像ファイル
- **出力**: JSONファイル
- **読み込み**: JSONファイル

---

## アプリケーションの起動

### 必要な環境
- モダンブラウザ（Chrome、Firefox、Edge、Safari）
- JavaScript有効
- インターネット接続（初回読み込み時のみ）

### 起動手順
1. ブラウザでアプリケーションを開く
2. 画面が表示されることを確認
3. 「PNG画像を選択」ボタンが表示されていることを確認

---

## 基本的な操作手順

### 1. 画像の読み込み
1. 「PNG画像を選択」ボタンをクリック
2. ファイル選択ダイアログが開く（モダンブラウザでは高度なファイル選択機能を使用）
3. ハイキングマップなどのPNG画像を選択
4. 「開く」をクリック
5. 画像が画面に表示されることを確認

> **💡 ヒント**: Chrome、Edge等の対応ブラウザでは、後でJSONファイルを画像と同じフォルダに保存できます

### 2. 編集モードの選択
- **ポイント編集**: 個別のポイントを配置・管理
- **ルート編集**: ルートの中間点を配置

### 3. レイアウトの選択
- **サイドバー**: 左側に地図、右側にコントロールパネル
- **オーバーレイ**: 全画面地図、右上にフローティングパネル

---

## ポイント編集モード

### ポイントの追加
1. 編集モードで「ポイント編集」を選択
2. 地図上の任意の場所をクリック
3. 赤いマーカーが表示される
4. 自動的にID入力欄が表示され、フォーカスされる
5. 4文字以内のIDを入力（例：A001、START、GOAL）
6. 他の場所をクリックすると入力が確定

### ポイントの管理
- **ID入力**: 英数字のみ、自動的に大文字に変換
- **自動削除**: IDが空欄のまま他の場所をクリックすると自動削除
- **最大文字数**: 4文字まで

### ポイントの削除
- **個別削除**: ID入力欄を空にして他の場所をクリック
- **一括削除**: 「ポイントをクリア」ボタンをクリック

### データの出力
1. 「ポイントをJSON出力」ボタンをクリック
2. ファイル保存ダイアログが表示される
3. **対応ブラウザ（Chrome、Edge等）**：
   - PNG画像と同じフォルダが自動的に開く
   - デフォルトファイル名：`{画像名}_points.json`（例：`hakone_map_points.json`）
   - 任意のファイル名に変更可能
4. **その他ブラウザ**：従来のダウンロード方式
5. 「保存」をクリックするとJSONファイルが保存される

> **📁 保存場所**: 対応ブラウザでは画像ファイルと同じフォルダに保存されるため、ファイル管理が簡単です

### データの読み込み
1. 「ポイントのJSON読込」ボタンをクリック
2. 既存のJSONファイルを選択
3. ポイントデータが復元される

---

## ルート編集モード

### ルートの作成
1. **事前準備**：ポイント編集モードで開始・終了ポイントを作成
2. 編集モードで「ルート編集」を選択
3. 開始ポイントIDを入力（既存のポイントID）
4. 終了ポイントIDを入力（既存のポイントID）
5. 地図上をクリックして中間点を追加
6. 青いマーカーが表示される

> **⚠️ 重要**: 開始・終了ポイントは事前にポイント編集モードで登録しておく必要があります

### 中間点の管理
- **追加**: 地図上をクリック
- **削除**: 「ルートをクリア」ボタンで一括削除
- **表示**: 青色の小さなマーカー（半径3px）

### ルートデータの出力
1. 開始・終了ポイントが設定されていることを確認
2. 「ルートをJSON出力」ボタンをクリック
3. **自動チェック**：開始・終了ポイントが登録済みポイントとして存在するか確認
4. ファイル保存ダイアログが表示される
5. **対応ブラウザ（Chrome、Edge等）**：
   - PNG画像と同じフォルダが自動的に開く
   - デフォルトファイル名：`{画像名}_route_{開始}-{終了}.json`（例：`hakone_map_route_A1-B5.json`）
   - 任意のファイル名に変更可能
6. **その他ブラウザ**：従来のダウンロード方式
7. 「保存」をクリックするとJSONファイルが保存される

> **✅ 自動チェック機能**: 存在しない開始・終了ポイントIDを指定した場合、エラーメッセージが表示されます

### ルートデータの読み込み
1. 「ルートのJSON読込」ボタンをクリック
2. 既存のルートJSONファイルを選択
3. ルートデータが復元される

---

## レイアウトの切り替え

### サイドバーレイアウト
- **特徴**: 左側に地図、右側にコントロールパネル
- **用途**: デスクトップ環境での作業
- **パネル幅**: 240px

### オーバーレイレイアウト
- **特徴**: 全画面地図、右上にフローティングパネル
- **用途**: 大きな地図表示が必要な場合
- **背景**: 半透明効果

### 切り替え方法
1. 右上のレイアウト選択ボタンをクリック
2. 「サイドバー」または「オーバーレイ」を選択
3. レイアウトが即座に切り替わる

---

## データの保存と読み込み

### ポイントデータの構造
```json
{
  "totalPoints": 5,
  "imageInfo": {
    "width": 1920,
    "height": 1080
  },
  "points": [
    {
      "index": 1,
      "id": "A001",
      "x": 640,
      "y": 480,
      "isMarker": false
    }
  ],
  "exportedAt": "2025-01-08T12:34:56.789Z"
}
```

### ルートデータの構造
```json
{
  "routeInfo": {
    "startPoint": "START",
    "endPoint": "GOAL",
    "waypointCount": 3
  },
  "imageInfo": {
    "width": 1920,
    "height": 1080
  },
  "points": [
    {
      "type": "waypoint",
      "index": 1,
      "x": 320,
      "y": 240
    }
  ],
  "exportedAt": "2025-01-08T12:34:56.789Z"
}
```

### データの互換性
- **画像サイズ**: 同じ画像を使用することを推奨
- **座標変換**: 異なるサイズの画像でも自動調整
- **ID管理**: ポイントIDは一意である必要がある

---

## よくある質問（FAQ）

### Q1: 対応していない画像形式はありますか？
**A**: PNG形式のみ対応しています。JPG、GIF、BMPなどは使用できません。

### Q2: ポイントのIDは何文字まで入力できますか？
**A**: 最大4文字まで入力可能です。英数字のみ使用できます。

### Q3: 一度に何個のポイントを追加できますか？
**A**: 制限はありませんが、大量のポイントは画面が見づらくなる可能性があります。

### Q4: ルート編集で開始・終了ポイントは必須ですか？
**A**: はい、必須です。また、指定したポイントIDは事前にポイント編集モードで登録されている必要があります。

### Q5: データを失わずに画像を変更できますか？
**A**: 画像を変更すると、現在のポイント・ルートデータはクリアされます。事前にJSON出力を推奨します。

### Q6: モバイル端末でも使用できますか？
**A**: 対応していますが、デスクトップ環境での使用を推奨します。

### Q7: ファイルが画像と同じフォルダに保存されないのはなぜですか？
**A**: File System Access API対応ブラウザ（Chrome 86+、Edge 86+）でのみこの機能が利用できます。その他のブラウザでは従来のダウンロード方式になります。

### Q8: ルート出力時にエラーが表示されます
**A**: 開始・終了ポイントのIDが登録済みのポイントと一致しているか確認してください。大文字・小文字も完全に一致する必要があります。

### Q9: ファイル選択ダイアログが二度表示されることがあります
**A**: 最新バージョンでは修正済みです。古いバージョンをお使いの場合は、ページを再読み込みしてください。

---

## トラブルシューティング

### 画像が読み込めない
**原因**: ファイル形式がPNG以外
**解決方法**: PNG形式の画像を選択してください

### ポイントが追加されない
**原因**: 画像が読み込まれていない
**解決方法**: 先にPNG画像を読み込んでください

### ID入力欄が表示されない
**原因**: ポイント編集モードになっていない
**解決方法**: 編集モードを「ポイント編集」に切り替えてください

### データが出力されない
**原因**: ポイントが追加されていない
**解決方法**: 地図上にポイントを追加してから出力してください

### 画面が正しく表示されない
**原因**: ブラウザの互換性問題
**解決方法**: Chrome、Firefox、Edge、Safariの最新版を使用してください

### ファイルがダウンロードされない
**原因**: ブラウザの設定でダウンロードがブロックされている
**解決方法**: ブラウザの設定でダウンロードを許可してください

### ルートが出力できない
**原因1**: 開始・終了ポイントが未設定
**解決方法**: 両方のポイントIDを設定してください

**原因2**: 指定したポイントIDが存在しない
**解決方法**: 先にポイント編集モードで該当IDのポイントを作成してください

### ファイル保存場所が分からない
**原因**: ブラウザの既定のダウンロードフォルダに保存されている
**解決方法**: Chrome、Edge等の対応ブラウザを使用すると、画像と同じフォルダに保存できます

---

## 操作のコツ

### 効率的なポイント配置
1. **計画を立てる**: 事前にポイントの配置計画を立てる
2. **ID命名規則**: 分かりやすいID命名規則を決める（例：A001、B001）
3. **段階的作業**: 大きな地図はエリアごとに分けて作業

### データ管理のベストプラクティス
1. **定期的な保存**: 作業中は定期的にJSON出力する
2. **バックアップ**: 重要なデータは複数バックアップを取る
3. **ファイル命名**: 対応ブラウザでは自動的に分かりやすいファイル名が生成される
4. **フォルダ整理**: 画像と同じフォルダに保存されるため、プロジェクトごとにフォルダを分ける
5. **ルート作成**: 先にポイントを作成してからルート編集を行う

### パフォーマンスの最適化
1. **画像サイズ**: 適切なサイズの画像を使用
2. **ポイント数**: 必要最小限のポイント数に抑える
3. **ブラウザ**: 最新のブラウザを使用

---

**作成日**: 2025年1月8日  
**バージョン**: 1.1  
**更新日**: 2025年1月9日  
**対象アプリケーション**: PickPoints v1.2  
**更新内容**: File System Access API対応、ルートファイル名自動生成、開始・終了ポイント存在チェック機能追加  
**作成者**: Claude Code
